<form class="{{cssClass}} flexcol" autocomplete="off">
    
    {{!-- Character Header --}}
    <header class="sheet-header">
        <img class="profile-img" src="{{actor.img}}" data-edit="img" title="{{actor.name}}" height="100" width="100"/>
        <div class="header-fields">
            <h1 class="charname">
                <input name="name" type="text" value="{{actor.name}}" placeholder="Character Name"/>
            </h1>
            <div class="resource-row">
                <div class="resource">
                    <label>Race</label>
                    <input type="text" name="system.personalDetails.race" value="{{system.personalDetails.race}}" />
                    {{!-- Misc Special Rules --}}
                </div>
        </div>
                <div class="resource">
                    <label>Current Career</label>
                    <span class="current-career-display">{{currentCareer}}</span>
                </div>
                <div class="resource full-width">
                    <label>Previous Careers</label>
                    <input type="text" name="system.previousCareersText" value="{{system.previousCareersText}}" placeholder="List previous careers"/>
                </div>
            </div>
        </div>
        <div class="experience-header">
            <h4>Experience</h4>
            <div class="experience-fields">
                <div class="xp-field">
                    <label>Total XP</label>
                    <input type="number" name="system.experience.total" value="{{system.experience.total}}" />
                </div>
                <div class="xp-field">
                    <label>Spent XP</label>
                    <input type="number" name="system.experience.spent" value="{{system.experience.spent}}" />
                </div>
            </div>
        </div>
    </header>

    {{!-- Sheet Tab Navigation --}}
    <nav class="sheet-tabs tabs" data-group="primary">
        <a class="item" data-tab="main">Main</a>
        <a class="item" data-tab="skills">Skills</a>
        <a class="item" data-tab="career">Career</a>
        <a class="item" data-tab="combat">Combat</a>
        <a class="item" data-tab="spells">Spells</a>
        <a class="item" data-tab="inventory">Inventory</a>
        <a class="item" data-tab="biography">Biography</a>
    </nav>

    {{!-- Sheet Body --}}
    <section class="sheet-body">

        {{!-- Main Tab --}}
        <div class="tab main" data-group="primary" data-tab="main">
            
            {{!-- Main Profile Table --}}
            <div class="profile-section">
                <h3>Main Profile</h3>
                <table class="profile-table">
                    <thead>
                        <tr>
                            <th></th>
                            <th>{{localize "WFRP2E.CharacteristicAbbrevWS"}}</th>
                            <th>{{localize "WFRP2E.CharacteristicAbbrevBS"}}</th>
                            <th>{{localize "WFRP2E.CharacteristicAbbrevS"}}</th>
                            <th>{{localize "WFRP2E.CharacteristicAbbrevT"}}</th>
                            <th>{{localize "WFRP2E.CharacteristicAbbrevAg"}}</th>
                            <th>{{localize "WFRP2E.CharacteristicAbbrevInt"}}</th>
                            <th>{{localize "WFRP2E.CharacteristicAbbrevWP"}}</th>
                            <th>{{localize "WFRP2E.CharacteristicAbbrevFel"}}</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="row-label">{{localize "WFRP2E.RowStarting"}}</td>
                            <td><input type="number" name="system.characteristics.ws.initial" value="{{system.characteristics.ws.initial}}" data-dtype="Number" /></td>
                            <td><input type="number" name="system.characteristics.bs.initial" value="{{system.characteristics.bs.initial}}" data-dtype="Number" /></td>
                            <td><input type="number" name="system.characteristics.s.initial" value="{{system.characteristics.s.initial}}" data-dtype="Number" /></td>
                            <td><input type="number" name="system.characteristics.t.initial" value="{{system.characteristics.t.initial}}" data-dtype="Number" /></td>
                            <td><input type="number" name="system.characteristics.ag.initial" value="{{system.characteristics.ag.initial}}" data-dtype="Number" /></td>
                            <td><input type="number" name="system.characteristics.int.initial" value="{{system.characteristics.int.initial}}" data-dtype="Number" /></td>
                            <td><input type="number" name="system.characteristics.wp.initial" value="{{system.characteristics.wp.initial}}" data-dtype="Number" /></td>
                            <td><input type="number" name="system.characteristics.fel.initial" value="{{system.characteristics.fel.initial}}" data-dtype="Number" /></td>
                        </tr>
                        <tr>
                            <td class="row-label">{{localize "WFRP2E.RowTalents"}}</td>
                            <td><input type="number" name="system.characteristics.ws.talents" value="{{system.characteristics.ws.talents}}" data-dtype="Number" /></td>
                            <td><input type="number" name="system.characteristics.bs.talents" value="{{system.characteristics.bs.talents}}" data-dtype="Number" /></td>
                            <td><input type="number" name="system.characteristics.s.talents" value="{{system.characteristics.s.talents}}" data-dtype="Number" /></td>
                            <td><input type="number" name="system.characteristics.t.talents" value="{{system.characteristics.t.talents}}" data-dtype="Number" /></td>
                            <td><input type="number" name="system.characteristics.ag.talents" value="{{system.characteristics.ag.talents}}" data-dtype="Number" /></td>
                            <td><input type="number" name="system.characteristics.int.talents" value="{{system.characteristics.int.talents}}" data-dtype="Number" /></td>
                            <td><input type="number" name="system.characteristics.wp.talents" value="{{system.characteristics.wp.talents}}" data-dtype="Number" /></td>
                            <td><input type="number" name="system.characteristics.fel.talents" value="{{system.characteristics.fel.talents}}" data-dtype="Number" /></td>
                        </tr>
                        <tr>
                            <td class="row-label">{{localize "WFRP2E.RowCareer"}}</td>
                            <td><span class="career-value">{{system.characteristics.ws.career}}</span></td>
                            <td><span class="career-value">{{system.characteristics.bs.career}}</span></td>
                            <td><span class="career-value">{{system.characteristics.s.career}}</span></td>
                            <td><span class="career-value">{{system.characteristics.t.career}}</span></td>
                            <td><span class="career-value">{{system.characteristics.ag.career}}</span></td>
                            <td><span class="career-value">{{system.characteristics.int.career}}</span></td>
                            <td><span class="career-value">{{system.characteristics.wp.career}}</span></td>
                            <td><span class="career-value">{{system.characteristics.fel.career}}</span></td>
                        </tr>
                        <tr>
                            <td class="row-label">{{localize "WFRP2E.RowAdvance"}}</td>
                            <td><input type="number" name="system.characteristics.ws.advances" value="{{system.characteristics.ws.advances}}" data-dtype="Number" /></td>
                            <td><input type="number" name="system.characteristics.bs.advances" value="{{system.characteristics.bs.advances}}" data-dtype="Number" /></td>
                            <td><input type="number" name="system.characteristics.s.advances" value="{{system.characteristics.s.advances}}" data-dtype="Number" /></td>
                            <td><input type="number" name="system.characteristics.t.advances" value="{{system.characteristics.t.advances}}" data-dtype="Number" /></td>
                            <td><input type="number" name="system.characteristics.ag.advances" value="{{system.characteristics.ag.advances}}" data-dtype="Number" /></td>
                            <td><input type="number" name="system.characteristics.int.advances" value="{{system.characteristics.int.advances}}" data-dtype="Number" /></td>
                            <td><input type="number" name="system.characteristics.wp.advances" value="{{system.characteristics.wp.advances}}" data-dtype="Number" /></td>
                            <td><input type="number" name="system.characteristics.fel.advances" value="{{system.characteristics.fel.advances}}" data-dtype="Number" /></td>
                        </tr>
                        <tr>
                            <td class="row-label">{{localize "WFRP2E.RowMisc"}}</td>
                            <td><input type="number" name="system.characteristics.ws.misc" value="{{system.characteristics.ws.misc}}" data-dtype="Number" /></td>
                            <td><input type="number" name="system.characteristics.bs.misc" value="{{system.characteristics.bs.misc}}" data-dtype="Number" /></td>
                            <td><input type="number" name="system.characteristics.s.misc" value="{{system.characteristics.s.misc}}" data-dtype="Number" /></td>
                            <td><input type="number" name="system.characteristics.t.misc" value="{{system.characteristics.t.misc}}" data-dtype="Number" /></td>
                            <td><input type="number" name="system.characteristics.ag.misc" value="{{system.characteristics.ag.misc}}" data-dtype="Number" /></td>
                            <td><input type="number" name="system.characteristics.int.misc" value="{{system.characteristics.int.misc}}" data-dtype="Number" /></td>
                            <td><input type="number" name="system.characteristics.wp.misc" value="{{system.characteristics.wp.misc}}" data-dtype="Number" /></td>
                            <td><input type="number" name="system.characteristics.fel.misc" value="{{system.characteristics.fel.misc}}" data-dtype="Number" /></td>
                        </tr>
                        <tr class="current-row">
                            <td class="row-label">{{localize "WFRP2E.RowCurrent"}}</td>
                            <td class="current-value rollable-characteristic" data-characteristic="ws" title="Click to roll">{{system.characteristics.ws.current}}</td>
                            <td class="current-value rollable-characteristic" data-characteristic="bs" title="Click to roll">{{system.characteristics.bs.current}}</td>
                            <td class="current-value rollable-characteristic" data-characteristic="s" title="Click to roll">{{system.characteristics.s.current}}</td>
                            <td class="current-value rollable-characteristic" data-characteristic="t" title="Click to roll">{{system.characteristics.t.current}}</td>
                            <td class="current-value rollable-characteristic" data-characteristic="ag" title="Click to roll">{{system.characteristics.ag.current}}</td>
                            <td class="current-value rollable-characteristic" data-characteristic="int" title="Click to roll">{{system.characteristics.int.current}}</td>
                            <td class="current-value rollable-characteristic" data-characteristic="wp" title="Click to roll">{{system.characteristics.wp.current}}</td>
                            <td class="current-value rollable-characteristic" data-characteristic="fel" title="Click to roll">{{system.characteristics.fel.current}}</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            {{!-- Secondary Profile Table --}}
            <div class="profile-section">
                <h3>Secondary Profile</h3>
                <table class="profile-table">
                    <thead>
                        <tr>
                            <th></th>
                            <th>{{localize "WFRP2E.SecondaryAbbrevA"}}</th>
                            <th>{{localize "WFRP2E.SecondaryAbbrevW"}}</th>
                            <th>{{localize "WFRP2E.SecondaryAbbrevSB"}}</th>
                            <th>{{localize "WFRP2E.SecondaryAbbrevTB"}}</th>
                            <th>{{localize "WFRP2E.SecondaryAbbrevM"}}</th>
                            <th>{{localize "WFRP2E.SecondaryAbbrevMag"}}</th>
                            <th>{{localize "WFRP2E.SecondaryAbbrevIP"}}</th>
                            <th>{{localize "WFRP2E.SecondaryAbbrevFP"}}</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td class="row-label">{{localize "WFRP2E.RowStarting"}}</td>
                            <td><input type="number" name="system.secondary.attacks.initial" value="{{system.secondary.attacks.initial}}" data-dtype="Number" /></td>
                            <td><input type="number" name="system.secondary.wounds.initial" value="{{system.secondary.wounds.initial}}" data-dtype="Number" /></td>
                            <td class="calculated-value">-</td>
                            <td class="calculated-value">-</td>
                            <td><input type="number" name="system.secondary.movement.initial" value="{{system.secondary.movement.initial}}" data-dtype="Number" /></td>
                            <td><input type="number" name="system.secondary.magic.initial" value="{{system.secondary.magic.initial}}" data-dtype="Number" /></td>
                            <td><input type="number" name="system.secondary.insanityPoints.initial" value="{{system.secondary.insanityPoints.initial}}" data-dtype="Number" /></td>
                            <td><input type="number" name="system.secondary.fatePoints.initial" value="{{system.secondary.fatePoints.initial}}" data-dtype="Number" /></td>
                        </tr>
                        <tr>
                            <td class="row-label">{{localize "WFRP2E.RowTalents"}}</td>
                            <td><input type="number" name="system.secondary.attacks.talents" value="{{system.secondary.attacks.talents}}" data-dtype="Number" /></td>
                            <td><input type="number" name="system.secondary.wounds.talents" value="{{system.secondary.wounds.talents}}" data-dtype="Number" /></td>
                            <td>-</td>
                            <td>-</td>
                            <td><input type="number" name="system.secondary.movement.talents" value="{{system.secondary.movement.talents}}" data-dtype="Number" /></td>
                            <td><input type="number" name="system.secondary.magic.talents" value="{{system.secondary.magic.talents}}" data-dtype="Number" /></td>
                            <td>-</td>
                            <td>-</td>
                        </tr>
                        <tr>
                            <td class="row-label">{{localize "WFRP2E.RowCareer"}}</td>
                            <td><span class="career-value">{{system.secondary.attacks.career}}</span></td>
                            <td><span class="career-value">{{system.secondary.wounds.career}}</span></td>
                            <td>-</td>
                            <td>-</td>
                            <td><span class="career-value">{{system.secondary.movement.career}}</span></td>
                            <td><span class="career-value">{{system.secondary.magic.career}}</span></td>
                            <td>-</td>
                            <td>-</td>
                        </tr>
                        <tr>
                            <td class="row-label">{{localize "WFRP2E.RowAdvance"}}</td>
                            <td><input type="number" name="system.secondary.attacks.advances" value="{{system.secondary.attacks.advances}}" data-dtype="Number" /></td>
                            <td><input type="number" name="system.secondary.wounds.advances" value="{{system.secondary.wounds.advances}}" data-dtype="Number" /></td>
                            <td class="calculated-value">-</td>
                            <td class="calculated-value">-</td>
                            <td><input type="number" name="system.secondary.movement.advances" value="{{system.secondary.movement.advances}}" data-dtype="Number" /></td>
                            <td><input type="number" name="system.secondary.magic.advances" value="{{system.secondary.magic.advances}}" data-dtype="Number" /></td>
                            <td class="calculated-value">-</td>
                            <td class="calculated-value">-</td>
                        </tr>
                        <tr>
                            <td class="row-label">{{localize "WFRP2E.RowMisc"}}</td>
                            <td><input type="number" name="system.secondary.attacks.misc" value="{{system.secondary.attacks.misc}}" data-dtype="Number" /></td>
                            <td><input type="number" name="system.secondary.wounds.misc" value="{{system.secondary.wounds.misc}}" data-dtype="Number" /></td>
                            <td><input type="number" name="system.secondary.strengthBonus.misc" value="{{system.secondary.strengthBonus.misc}}" data-dtype="Number" /></td>
                            <td><input type="number" name="system.secondary.toughnessBonus.misc" value="{{system.secondary.toughnessBonus.misc}}" data-dtype="Number" /></td>
                            <td><input type="number" name="system.secondary.movement.misc" value="{{system.secondary.movement.misc}}" data-dtype="Number" /></td>
                            <td><input type="number" name="system.secondary.magic.misc" value="{{system.secondary.magic.misc}}" data-dtype="Number" /></td>
                            <td><input type="number" name="system.secondary.insanityPoints.misc" value="{{system.secondary.insanityPoints.misc}}" data-dtype="Number" /></td>
                            <td><input type="number" name="system.secondary.fatePoints.misc" value="{{system.secondary.fatePoints.misc}}" data-dtype="Number" /></td>
                        </tr>
                        <tr class="current-row">
                            <td class="row-label">{{localize "WFRP2E.RowCurrent"}}</td>
                            <td class="current-value">{{system.secondary.attacks.current}}</td>
                            <td class="current-value">{{system.secondary.wounds.current}}</td>
                            <td class="current-value">{{system.secondary.strengthBonus.value}}</td>
                            <td class="current-value">{{system.secondary.toughnessBonus.value}}</td>
                            <td class="current-value">{{system.secondary.movement.current}}</td>
                            <td class="current-value">{{system.secondary.magic.current}}</td>
                            <td class="current-value">{{system.secondary.insanityPoints.current}}</td>
                            <td class="current-value">{{system.secondary.fatePoints.current}}</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            {{!-- Talents --}}
            <div class="talents-section">
                <h3>Talents</h3>
                <div class="item-list">
                    {{#each talents as |talent|}}
                    <div class="item-entry">
                        <div class="item-header-row">
                            <div class="item-name">
                                <img src="{{talent.img}}" class="item-img" />
                                <span class="item-title">{{talent.name}}</span>
                            </div>
                            <div class="item-controls">
                                <a class="item-control item-edit" data-item-id="{{talent.id}}" title="Edit"><i class="fas fa-edit"></i></a>
                                <a class="item-control item-delete" data-item-id="{{talent.id}}" title="Delete"><i class="fas fa-trash"></i></a>
                            </div>
                        </div>
                        {{#if talent.system.description}}
                        <div class="item-description">
                            {{{talent.system.description}}}
                        </div>
                        {{/if}}
                    </div>
                    {{else}}
                    <p class="empty-message">Drag talent items here from the Items directory.</p>
                    {{/each}}
                </div>
            </div>

            {{!-- Mutations --}}
            <div class="mutations-section">
                <h3>Mutations</h3>
                <div class="item-list">
                    {{#each mutations as |mutation|}}
                    <div class="item-entry">
                        <div class="item-name">
                            <img src="{{mutation.img}}" class="item-img" />
                            <span>{{mutation.name}}</span>
                        </div>
                        <div class="item-controls">
                            <a class="item-control item-edit" data-item-id="{{mutation.id}}" title="Edit"><i class="fas fa-edit"></i></a>
                            <a class="item-control item-delete" data-item-id="{{mutation.id}}" title="Delete"><i class="fas fa-trash"></i></a>
                        </div>
                        {{#if mutation.system.description}}
                        <div class="item-description">
                            {{{mutation.system.description}}}
                        </div>
                        {{/if}}
                    </div>
                    {{else}}
                    <p class="empty-message">Drag mutation items here from the Items directory.</p>
                    {{/each}}
                </div>
            </div>

            {{!-- Insanities --}}
            <div class="insanities-section">
                <h3>Insanities</h3>
                <div class="item-list">
                    {{#each insanities as |insanity|}}
                    <div class="item-entry">
                        <div class="item-name">
                            <img src="{{insanity.img}}" class="item-img" />
                            <span>{{insanity.name}}</span>
                        </div>
                        <div class="item-controls">
                            <a class="item-control item-edit" data-item-id="{{insanity.id}}" title="Edit"><i class="fas fa-edit"></i></a>
                            <a class="item-control item-delete" data-item-id="{{insanity.id}}" title="Delete"><i class="fas fa-trash"></i></a>
                        </div>
                        {{#if insanity.system.description}}
                        <div class="item-description">
                            {{{insanity.system.description}}}
                        </div>
                        {{/if}}

                    </div>
                    {{else}}
                    <p class="empty-message">Drag insanity items here from the Items directory.</p>
                    {{/each}}
                </div>
            </div>

            {{!-- Misc Special Rules --}}
            <div class="special-rules-section">
                <h3>Misc Special Rules</h3>
                <div class="special-rules-list">
                    <div class="special-rule-header">
                        <span>Name</span>
                        <span>Description</span>
                        <span></span>
                    </div>
                    {{#each system.specialRules as |rule idx|}}
                    <div class="special-rule-row">
                        <input type="text" name="system.specialRules.{{idx}}.name" value="{{rule.name}}" placeholder="Rule Name"/>
                        <input type="text" name="system.specialRules.{{idx}}.description" value="{{rule.description}}" placeholder="Description"/>
                        <a class="special-rule-delete" data-index="{{idx}}"><i class="fas fa-trash"></i></a>
                    </div>
                    {{/each}}
                    <button type="button" class="add-special-rule">Add Special Rule</button>
                </div>
            </div>
        </div>

        {{!-- Skills Tab --}}
        <div class="tab skills" data-group="primary" data-tab="skills">
            
            {{!-- Basic Skills Section --}}
            <div class="skills-section">
                <h3>Basic Skills</h3>
                <div class="skills-list">
                    <div class="skill-header">
                        <span>Name</span>
                        <span>Characteristic</span>
                        <span>Trained</span>
                        <span>Advances</span>
                        <span>Modifier</span>
                        <span>Target</span>
                        <span>Roll</span>
                        <span></span>
                    </div>
                    
                    {{#each system.skills as |skill idx|}}
                    {{#if (eq skill.category "basic")}}
                    <div class="skill-row">
                        <input type="hidden" name="system.skills.{{idx}}.category" value="{{skill.category}}" />
                        <input type="text" name="system.skills.{{idx}}.name" value="{{skill.name}}" placeholder="Skill Name"/>
                        <select name="system.skills.{{idx}}.characteristic" value="{{skill.characteristic}}">
                            <option value="">-</option>
                            <option value="ws" {{#if (eq skill.characteristic "ws")}}selected{{/if}}>WS</option>
                            <option value="bs" {{#if (eq skill.characteristic "bs")}}selected{{/if}}>BS</option>
                            <option value="s" {{#if (eq skill.characteristic "s")}}selected{{/if}}>S</option>
                            <option value="t" {{#if (eq skill.characteristic "t")}}selected{{/if}}>T</option>
                            <option value="ag" {{#if (eq skill.characteristic "ag")}}selected{{/if}}>Ag</option>
                            <option value="int" {{#if (eq skill.characteristic "int")}}selected{{/if}}>Int</option>
                            <option value="wp" {{#if (eq skill.characteristic "wp")}}selected{{/if}}>WP</option>
                            <option value="fel" {{#if (eq skill.characteristic "fel")}}selected{{/if}}>Fel</option>
                        </select>
                        <input type="checkbox" name="system.skills.{{idx}}.trained" {{checked skill.trained}} />
                        <input type="number" name="system.skills.{{idx}}.advances" value="{{skill.advances}}" />
                        <input type="number" name="system.skills.{{idx}}.modifier" value="{{skill.modifier}}" />
                        <span class="skill-target">{{skill.target}}</span>
                        <button type="button" class="skill-roll rollable-skill" data-skill-index="{{idx}}" title="Roll skill"><i class="fas fa-dice-d20"></i></button>
                        <span class="skill-locked" title="Cannot delete default skills"><i class="fas fa-lock"></i></span>
                    </div>
                    {{/if}}
                    {{/each}}
                </div>
            </div>

            {{!-- Advanced Skills Section --}}
            <div class="skills-section">
                <h3>Advanced Skills</h3>
                <div class="skills-list">
                    <div class="skill-header">
                        <span>Name</span>
                        <span>Characteristic</span>
                        <span>Trained</span>
                        <span>Advances</span>
                        <span>Modifier</span>
                        <span>Target</span>
                        <span>Roll</span>
                        <span></span>
                    </div>
                    
                    {{#each system.skills as |skill idx|}}
                    {{#if (eq skill.category "advanced")}}
                    <div class="skill-row">
                        <input type="hidden" name="system.skills.{{idx}}.category" value="{{skill.category}}" />
                        <input type="text" name="system.skills.{{idx}}.name" value="{{skill.name}}" placeholder="Skill Name"/>
                        <select name="system.skills.{{idx}}.characteristic">
                            <option value="">-</option>
                            <option value="ws" {{#if (eq skill.characteristic "ws")}}selected{{/if}}>WS</option>
                            <option value="bs" {{#if (eq skill.characteristic "bs")}}selected{{/if}}>BS</option>
                            <option value="s" {{#if (eq skill.characteristic "s")}}selected{{/if}}>S</option>
                            <option value="t" {{#if (eq skill.characteristic "t")}}selected{{/if}}>T</option>
                            <option value="ag" {{#if (eq skill.characteristic "ag")}}selected{{/if}}>Ag</option>
                            <option value="int" {{#if (eq skill.characteristic "int")}}selected{{/if}}>Int</option>
                            <option value="wp" {{#if (eq skill.characteristic "wp")}}selected{{/if}}>WP</option>
                            <option value="fel" {{#if (eq skill.characteristic "fel")}}selected{{/if}}>Fel</option>
                        </select>
                        <input type="checkbox" name="system.skills.{{idx}}.trained" {{checked skill.trained}} />
                        <input type="number" name="system.skills.{{idx}}.advances" value="{{skill.advances}}" />
                        <input type="number" name="system.skills.{{idx}}.modifier" value="{{skill.modifier}}" />
                        <span class="skill-target">{{skill.target}}</span>
                        <button type="button" class="skill-roll rollable-skill" data-skill-index="{{idx}}" title="Roll skill"><i class="fas fa-dice-d20"></i></button>
                        <span class="skill-locked" title="Cannot delete default skills"><i class="fas fa-lock"></i></span>
                    </div>
                    {{/if}}
                    {{/each}}
                </div>
            </div>

            {{!-- Knowledge and Language Skills Section --}}
            <div class="skills-section">
                <h3>Knowledge and Language Skills</h3>
                <div class="skills-list">
                    <div class="skill-header">
                        <span>Name</span>
                        <span>Characteristic</span>
                        <span>Trained</span>
                        <span>Advances</span>
                        <span>Modifier</span>
                        <span>Target</span>
                        <span>Roll</span>
                        <span></span>
                    </div>
                    
                    {{#each system.skills as |skill idx|}}
                    {{#if (eq skill.category "knowledge")}}
                    <div class="skill-row">
                        <input type="hidden" name="system.skills.{{idx}}.category" value="{{skill.category}}" />
                        <input type="text" name="system.skills.{{idx}}.name" value="{{skill.name}}" placeholder="Skill Name"/>
                        <select name="system.skills.{{idx}}.characteristic">
                            <option value="">-</option>
                            <option value="ws" {{#if (eq skill.characteristic "ws")}}selected{{/if}}>WS</option>
                            <option value="bs" {{#if (eq skill.characteristic "bs")}}selected{{/if}}>BS</option>
                            <option value="s" {{#if (eq skill.characteristic "s")}}selected{{/if}}>S</option>
                            <option value="t" {{#if (eq skill.characteristic "t")}}selected{{/if}}>T</option>
                            <option value="ag" {{#if (eq skill.characteristic "ag")}}selected{{/if}}>Ag</option>
                            <option value="int" {{#if (eq skill.characteristic "int")}}selected{{/if}}>Int</option>
                            <option value="wp" {{#if (eq skill.characteristic "wp")}}selected{{/if}}>WP</option>
                            <option value="fel" {{#if (eq skill.characteristic "fel")}}selected{{/if}}>Fel</option>
                        </select>
                        <input type="checkbox" name="system.skills.{{idx}}.trained" {{checked skill.trained}} />
                        <input type="number" name="system.skills.{{idx}}.advances" value="{{skill.advances}}" />
                        <input type="number" name="system.skills.{{idx}}.modifier" value="{{skill.modifier}}" />
                        <span class="skill-target">{{skill.target}}</span>
                        <button type="button" class="skill-roll rollable-skill" data-skill-index="{{idx}}" title="Roll skill"><i class="fas fa-dice-d20"></i></button>
                        <a class="skill-delete" data-index="{{idx}}"><i class="fas fa-trash"></i></a>
                    </div>
                    {{/if}}
                    {{/each}}
                    
                    <button type="button" class="add-skill" data-category="knowledge">Add Knowledge/Language Skill</button>
                </div>
            </div>

            {{!-- Perform, Trade, and Other Skills Section --}}
            <div class="skills-section">
                <h3>Perform, Trade, and Other Skills</h3>
                <div class="skills-list">
                    <div class="skill-header">
                        <span>Name</span>
                        <span>Characteristic</span>
                        <span>Trained</span>
                        <span>Advances</span>
                        <span>Modifier</span>
                        <span>Target</span>
                        <span>Roll</span>
                        <span></span>
                    </div>
                    
                    {{#each system.skills as |skill idx|}}
                    {{#if (eq skill.category "other")}}
                    <div class="skill-row">
                        <input type="hidden" name="system.skills.{{idx}}.category" value="{{skill.category}}" />
                        <input type="text" name="system.skills.{{idx}}.name" value="{{skill.name}}" placeholder="Skill Name"/>
                        <select name="system.skills.{{idx}}.characteristic">
                            <option value="">-</option>
                            <option value="ws" {{#if (eq skill.characteristic "ws")}}selected{{/if}}>WS</option>
                            <option value="bs" {{#if (eq skill.characteristic "bs")}}selected{{/if}}>BS</option>
                            <option value="s" {{#if (eq skill.characteristic "s")}}selected{{/if}}>S</option>
                            <option value="t" {{#if (eq skill.characteristic "t")}}selected{{/if}}>T</option>
                            <option value="ag" {{#if (eq skill.characteristic "ag")}}selected{{/if}}>Ag</option>
                            <option value="int" {{#if (eq skill.characteristic "int")}}selected{{/if}}>Int</option>
                            <option value="wp" {{#if (eq skill.characteristic "wp")}}selected{{/if}}>WP</option>
                            <option value="fel" {{#if (eq skill.characteristic "fel")}}selected{{/if}}>Fel</option>
                        </select>
                        <input type="checkbox" name="system.skills.{{idx}}.trained" {{checked skill.trained}} />
                        <input type="number" name="system.skills.{{idx}}.advances" value="{{skill.advances}}" />
                        <input type="number" name="system.skills.{{idx}}.modifier" value="{{skill.modifier}}" />
                        <span class="skill-target">{{skill.target}}</span>
                        <button type="button" class="skill-roll rollable-skill" data-skill-index="{{idx}}" title="Roll skill"><i class="fas fa-dice-d20"></i></button>
                        <a class="skill-delete" data-index="{{idx}}"><i class="fas fa-trash"></i></a>
                    </div>
                    {{/if}}
                    {{/each}}
                    
                    <button type="button" class="add-skill" data-category="other">Add Perform/Trade/Other Skill</button>
                </div>
            </div>
        </div>

        {{!-- Career Tab --}}
        <div class="tab career" data-group="primary" data-tab="career">
            <p class="hint">Drag career items here from the Items directory to add them to this character.</p>
            
            {{#each careers as |career|}}
            <div class="career-item-simple {{#if career.system.isCurrent}}current-career{{/if}}">
                <div class="career-item-row">
                    <div class="career-name-section">
                        <h3>{{career.name}}</h3>
                        {{#if career.system.isCurrent}}<span class="current-badge">Current</span>{{/if}}
                    </div>
                    
                    <div class="career-controls-section">
                        <div class="career-checkboxes">
                            <label title="Mark as current career">
                                <input type="checkbox" class="career-current-toggle" data-item-id="{{career.id}}" {{checked career.system.isCurrent}} />
                                Current
                            </label>
                            <label title="Career entered">
                                Entered
                                <input type="number" class="career-entered-input" data-item-id="{{career.id}}" value="{{career.system.careerEntered}}" min="0" data-dtype="Number" style="width: 50px;" />
                            </label>
                        </div>
                        
                        <div class="career-item-controls">
                            <a class="item-control item-edit" data-item-id="{{career.id}}" title="Edit Career"><i class="fas fa-edit"></i></a>
                            <a class="item-control item-delete" data-item-id="{{career.id}}" title="Delete Career"><i class="fas fa-trash"></i></a>
                        </div>
                    </div>
                </div>
            </div>
            {{/each}}
            
            {{#unless careers}}
            <div class="empty-careers">
                <p><i class="fas fa-briefcase fa-3x"></i></p>
                <p><strong>No careers yet</strong></p>
                <p>Create career items in the Items directory and drag them here.</p>
            </div>
            {{/unless}}
        </div>

        {{!-- Combat Tab --}}
        <div class="tab combat" data-group="primary" data-tab="combat">
            <h3>Armour Points</h3>
            <div class="armour-grid">
                <div class="armour-location">
                    <label>Head</label>
                    <div class="armour-value">{{totalArmour.head}}</div>
                </div>
                <div class="armour-location">
                    <label>Body</label>
                    <div class="armour-value">{{totalArmour.body}}</div>
                </div>
                <div class="armour-location">
                    <label>Left Arm</label>
                    <div class="armour-value">{{totalArmour.leftArm}}</div>
                </div>
                <div class="armour-location">
                    <label>Right Arm</label>
                    <div class="armour-value">{{totalArmour.rightArm}}</div>
                </div>
                <div class="armour-location">
                    <label>Left Leg</label>
                    <div class="armour-value">{{totalArmour.leftLeg}}</div>
                </div>
                <div class="armour-location">
                    <label>Right Leg</label>
                    <div class="armour-value">{{totalArmour.rightLeg}}</div>
                </div>
            </div>

            <h3>Weapons</h3>
            <div class="tab combat" data-group="primary" data-tab="combat">
                <h3>Melee Weapons</h3>
                <ol class="items-list combat-list">
                    <li class="item items-header">
                        <div class="item-name">Weapon</div>
                        <div class="item-skill">Skill</div>
                        <div class="item-damage">Damage</div>
                        <div class="item-qualities">Qualities</div>
                        <div class="item-controls"></div>
                    </li>

                    {{#each weapons as |weapon|}}
                    {{#unless weapon.system.isRanged}}
                    <li class="item" data-item-id="{{weapon.id}}">
                        <div class="item-name">
                            <img src="{{weapon.img}}" title="{{weapon.name}}" width="24" height="24"/>
                            <h4>{{weapon.name}}</h4>
                        </div>
                        <div class="item-skill">{{weapon.system.group}}</div>
                        <div class="item-damage">
                            SB{{#if weapon.system.damage}}+{{weapon.system.damage}}{{/if}}
                            {{#if weapon.system.hasImpact}}<span class="quality-badge">Impact</span>{{/if}}
                        </div>
                        <div class="item-qualities">
                            {{weapon.system.qualities}}
                            {{#if weapon.system.hasDefensive}}<span class="quality-badge">Defensive</span>{{/if}}
                        </div>
                        <div class="item-controls">
                            <a class="Iitem-control weapon-attack" data-item-id="{{weapon.id}}" title="Attack with {{weapon.name}}">
                                <i class="fas fa-dice-d20"></i>
                            </a>
                            <a class="item-control item-edit" data-item-id="{{weapon.id}}" title="Edit Weapon">
                                <i class="fas fa-edit"></i>
                            </a>
                        </div>
                    </li>
                    {{/unless}}
                    {{/each}}                
                </ol>
                <h3>Ranged Weapons</h3>
                <ol class="items-list combat-list">
                    <li class="item items-header">
                        <div class="item-name">Weapon</div>
                        <div class="item-skill">Skill</div>
                        <div class="item-range">Range</div>
                        <div class="item-damage">Damage</div>
                        <div class="item-reload">Reload</div>
                        <div class="item-qualities">Qualities</div>
                        <div class="item-controls"></div>
                    </li>

                    {{#each weapons as |weapon|}}
                    {{#if weapon.system.isRanged}}
                    <li class="item" data-item-id="{{weapon.id}}">
                        <div class="item-name">
                            <img src="{{weapon.img}}" title="{{weapon.name}}" width="24" height="24"/>
                            <h4>{{weapon.name}}</h4>
                        </div>
                        <div class="item-skill">{{weapon.system.group}}</div>
                        <div class="item-range">{{weapon.system.range}} yds</div>
                        <div class="item-damage">{{weapon.system.damage}}</div>
                        <div class="item-reload">{{weapon.system.reload}}</div>
                        <div class="item-qualities">{{weapon.system.qualities}}</div>
                        <div class="item-controls">
                            <a class="item-control weapon-attack" data-item-id="{{weapon.id}}" title="Attack with {{weapon.name}}">
                                <i class="fas fa-dice-d20"></i>
                            </a>
                            <a class="item-control item-edit" data-item-id="{{weapon.id}}" title="Edit Weapon">
                                <i class="fas fa-edit"></i>
                            </a>
                        </div>
                    </li>
                    {{/if}}
                    {{/each}}
                </ol>
            </div>
            
            <h3>Armour</h3>
            <ol class="items-list combat-list armour-list">
                <li class="item items-header">
                    <div class="item-equipped">Equipped</div>
                    <div class="item-name">Armour</div>
                    <div class="item-ap">AP</div>
                    <div class="item-locations-compact">Coverage</div>
                    <div class="item-controls"></div>
                </li>

                {{#each armours as |armour|}}
                <li class="item {{#if armor.isEquipped}}equipped{{/if}}" data-item-id="{{armor.id}}">
                    <div class="item-equipped">
                        <input type="checkbox" class="armour-equipped-toggle" data-item-id="{{armor.id}}" {{checked armour.system.isEquipped}} title="Toggle Equipped"/>
                    </div>
                    <div class="item-name">{{armour.name}}</div>
                    <div class="item-ap">{{armor.system.armourPoints}}</div>
                    <div class="item-locations-compact">
                        {{#if armor.system.head}}<span class="location-badge">H</span>{{/if}}
                        {{#if armor.system.armLeft}}<span class="location-badge">LA</span>{{/if}}
                        {{#if armor.system.armRight}}<span class="location-badge">RA</span>{{/if}}
                        {{#if armor.system.legLeft}}<span class="location-badge">LL</span>{{/if}}
                        {{#if armor.system.legRight}}<span class="location-badge">RL</span>{{/if}}
                    </div>
                    <div class="item-controls">
                        <a class="item-control item-edit" data-item-id="{{armour.id}}" title="Edit Armour">
                            <i class="fas fa-edit"></i>
                        </a>
                </li>
                {{/each}}
            </ol>
        </div>

        {{!-- Spells Tab --}}
        <div class="tab spells" data-group="primary" data-tab="spells">
            <h3>Spells</h3>
            <p><em>Spells will be added when item system is implemented</em></p>
        </div>

        {{!-- Inventory Tab --}}
        <div class="tab inventory" data-group="primary" data-tab="inventory">
            <h3>Money</h3>
            <div class="money-section-inventory">
                <div class="money-field">
                    <label>Gold Crowns (GC)</label>
                    <input type="number" name="system.money.gold" value="{{system.money.gold}}" />
                </div>
                <div class="money-field">
                    <label>Silver Shillings (SS)</label>
                    <input type="number" name="system.money.silver" value="{{system.money.silver}}" />
                </div>
                <div class="money-field">
                    <label>Brass Pennies (GC)</label>
                    <input type="number" name="system.money.brass" value="{{system.money.brass}}" />
                </div>
            </div>
            
            <h3>Inventory</h3>
            <!-- Weapons Section-->
             <div class="items-section">    
                <h3 class="items-header">
                    <span>Weapons</span>
                    <a class="item-control item-create" data-type="weapon" title="Create Weapon">
                        <i class="fas fa-plus"></i>
                    </a>
                </h3>

                <ol class="items-list">
                    <li class="item items-header">
                        <div class="item-name">Name</div>
                        <div class="item-group">Group</div>
                        <div class="item-damage">Damage</div>
                        <div class="item-range">Range</div>
                        <div class="item-enc">Enc</div>
                        <div class="item-controls"></div>
                    </li>

                    {{#each weapons as |weapon|}}
                    <li class="item" data-item-id="{{weapon.id}}">
                        <div class="item-name">{{weapon.name}}</div>
                        <div class="item-group">{{weapon.system.group}}</div>
                        <div class="item-damage">{{weapon.system.damage}}</div>
                        <div class="item-range">{{#if weapon.system.range}}{{weapon.system.range}} yds{{else}}Melee{{/if}}</div>
                        <div class="item-enc">{{weapon.system.encumberance}}</div>
                        <div class="item-controls">
                            <a class="item-control item-edit" data-item-id="{{weapon.id}}" title="Edit Weapon">
                                <i class="fas fa-edit"></i>
                            </a>
                            <a class="item-control item-delete" data-item-id="{{weapon.id}}" title="Delete Weapon">
                                <i class="fas fa-trash"></i>
                            </a>
                        </div>
                    </li>
                    {{/each}}
                </ol>
             </div>
             <!-- Armour Section -->
            <div class="items-section">
                <h3 class="items-header">
                    <span>Armour</span>
                    <a class="item-control item-create" data-type="armour" title="Create Armour">
                        <i class="fas fa-plus"></i>
                    </a>
                </h3>

                <ol class="items-list">
                    <li class="item items-header">
                        <div class="item-equipped">Equipped</div>
                        <div class="item-name">Name</div>
                        <div class="item-locations">Locations</div>
                        <div class="item-ap">AP</div>
                        <div class="item-enc">Enc</div>
                        <div class="item-controls"></div>
                    </li>

                    {{#each armours as |armour|}}
                    <li class="item {{#if armour.isEquipped}}equipped{{/if}}" data-item-id="{{armour.id}}">
                        <div class="item-equipped">
                            <input type="checkbox" class="armour-equipped-toggle" data-item-id="{{armour.id}}" {{checked armour.isEquipped}} title="Toggle Equipped"/>
                        </div>
                        <div class="item-name">
                            <img src="{{armour.img}}" title="{{armour.name}}" width="24" height="24"/>
                            <h4>{{armour.name}}</h4>
                        </div>
                        <div class="item-ap">{{armour.system.armourPoints}}</div>
                        <div class="item-enc">{{armour.system.encumbrance}}</div>
                        <div class="item-controls">
                            <a class="item-control item-edit" data-item-id="{{armour.id}}" title="Edit Armour">
                                <i class="fas fa-edit"></i>
                            </a>
                            <a class="item-control item-delete" data-item-id="{{armour.id}}" title="Delete Armour">
                                <i class="fas fa-trash"></i>
                            </a>
                        </div>
                    </li>
                    {{/each}}
                </ol>
            </div>
             <!-- Insert other Inventory sections here -->
        </div>

        {{!-- Biography Tab --}}
        <div class="tab biography" data-group="primary" data-tab="biography">
            
            {{!-- Astrology Section --}}
            <h3>Astrology</h3>
            <div class="astrology-section">
                <div class="astrology-field">
                    <label>Star Sign</label>
                    <input type="text" name="system.personalDetails.starSign" value="{{system.personalDetails.starSign}}" placeholder=""/>
                </div>
                <div class="astrology-field">
                    <label>Doom</label>
                    <input type="text" name="system.personalDetails.doom" value="{{system.personalDetails.doom}}" placeholder=""/>
                </div>
            </div>

            {{!-- Appearance Section --}}
            <h3>Appearance</h3>
            <div class="appearance-section">
                <div class="appearance-row">
                    <div class="appearance-field">
                        <label>Gender</label>
                        <input type="text" name="system.personalDetails.gender" value="{{system.personalDetails.gender}}" />
                    </div>
                    <div class="appearance-field">
                        <label>Build</label>
                        <input type="text" name="system.personalDetails.build" value="{{system.personalDetails.build}}" placeholder=""/>
                    </div>
                </div>
                <div class="appearance-row">
                    <div class="appearance-field">
                        <label>Age</label>
                        <input type="number" name="system.personalDetails.age" value="{{system.personalDetails.age}}" placeholder="20"/>
                    </div>
                    <div class="appearance-field">
                        <label>Height</label>
                        <input type="text" name="system.personalDetails.height" value="{{system.personalDetails.height}}" placeholder=""/>
                    </div>
                </div>
                <div class="appearance-row">
                    <div class="appearance-field">
                        <label>Weight</label>
                        <input type="text" name="system.personalDetails.weight" value="{{system.personalDetails.weight}}" placeholder=""/>
                    </div>
                    <div class="appearance-field">
                        <label>Eyes</label>
                        <input type="text" name="system.personalDetails.eyes" value="{{system.personalDetails.eyes}}" placeholder=""/>
                    </div>
                </div>
                <div class="appearance-row">
                    <div class="appearance-field">
                        <label>Skin</label>
                        <input type="text" name="system.personalDetails.skin" value="{{system.personalDetails.skin}}" placeholder=""/>
                    </div>
                    <div class="appearance-field">
                        <label>Hair</label>
                        <input type="text" name="system.personalDetails.hair" value="{{system.personalDetails.hair}}" placeholder=""/>
                    </div>
                </div>
            </div>

            {{!-- Description Section --}}
            <h3>Description</h3>
            {{editor system.biography target="system.biography" button=true owner=owner editable=editable}}

            {{!-- History Section --}}
            <h3>History</h3>
            {{editor system.history target="system.history" button=true owner=owner editable=editable}}
            
            {{!-- Miscellaneous Notes Section --}}
            <h3>Miscellaneous Notes</h3>
            {{editor system.notes target="system.notes" button=true owner=owner editable=editable}}
        </div>

    </section>
</form>